(function(a){var f=function(){};a.extend(f.prototype,{name:"ElementRepeatablePro",options:{msgDeleteElement:"Delete Element",msgSortElement:"Sort Element",msgLimitReached:"Limit reached",instanceLimit:"",url:""},initialize:function(b,e){this.options=a.extend({},this.options,e);var c=this,d=a("ul.repeatable-list",b),f=a("li.hidden",d).remove(),g=a("li.repeatable-element",d).length;c.element=b;c.list=d;c.count=g;c.options.msgAddInstance=a("p.add a",b).html();a("li.repeatable-element",d).each(function(){a(this).children().wrapAll(a("<div>").addClass("repeatable-content"));
c.attachButtons(a(this))});d.on("mousedown",".zlux-x-sort",function(){a(".more-options.show-advanced",d).removeClass("show-advanced");d.height(d.height());a(this).closest("li.repeatable-element").find(".more-options").hide().end().find(".file-details").hide()}).on("mouseup",".zlux-x-sort",function(){a(this).closest("li.repeatable-element").find(".more-options").show().end().find(".file-details").show()}).on("click",".zlux-x-delete",function(){a(this).closest("li.repeatable-element").fadeOut(200,function(){a(this).remove();
b.trigger("instance.deleted");c.options.instanceLimit&&a("p.add a",b).removeClass("disabled").html(c.options.msgAddInstance)})}).sortable({handle:".zlux-x-sort",placeholder:"repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:!1,start:function(b,c){c.item.addClass("ghost");c.placeholder.height(c.item.height()-2);c.placeholder.width(a("div.repeatable-content",c.item).width()-2)},stop:function(c,b){b.item.removeClass("ghost");a(".more-options",
b.item).show();a(".file-details",b.item).show();d.height("");a(".repeatable-element",a(c.target)).each(function(b){a("input, textarea",a(this)).each(function(){if(a(this).attr("name")){var c=a(this).attr("name").replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+b+"]");a(this).attr("name",c)}})})}});a("p.add a",b).on("click",function(){if(c.options.instanceLimit&&c.options.instanceLimit<=d.children().length)return!1;c.addElementInstance(f.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+c.count++ +"]"));
c.options.instanceLimit&&c.options.instanceLimit<=d.children().length&&a("p.add a",b).addClass("disabled").html(c.options.msgLimitReached)})},loadElementInstance:function(b){var e=this;a.ajax({url:e.options.ajax_url+"&task=callelement",type:"POST",data:{method:"loadeditlayout",layout:b},success:function(a){e.addElementInstance(a.replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+e.count++ +"]"));e.element.trigger("instance.added")}})},addElementInstance:function(b){b=a('<li class="repeatable-element" />').html(b);
b.children().wrapAll(a("<div>").addClass("repeatable-content"));this.attachButtons(b);a("input, textarea",b).filter(function(){return"hidden"!=a(this).attr("type")}).each(function(){a(this).val("").html("")});b.appendTo(this.list);b.children("div.repeatable-content").effect("highlight",{},1E3)},attachButtons:function(b){a(".zlux-x-sort, .zlux-x-delete",b)[0]||(a("<span>").addClass("zlux-x-sort sort").attr("title",this.options.msgSortElement).appendTo(b),a("<span>").addClass("zlux-x-delete delete").attr("title",
this.options.msgDeleteElement).appendTo(b))}});a.fn[f.prototype.name]=function(){var b=arguments,e=b[0]?b[0]:null;return this.each(function(){var c=a(this);if(f.prototype[e]&&c.data(f.prototype.name)&&"initialize"!=e)c.data(f.prototype.name)[e].apply(c.data(f.prototype.name),Array.prototype.slice.call(b,1));else if(!e||a.isPlainObject(e)){var d=new f;f.prototype.initialize&&d.initialize.apply(d,a.merge([c],b));c.data(f.prototype.name,d)}else a.error("Method "+e+" does not exist on jQuery."+f.name)})}})(jQuery);