(function(a){var e=function(){};a.extend(e.prototype,{name:"ElementRepeatablePro",options:{msgDeleteElement:"Delete Element",msgSortElement:"Sort Element",msgLimitReached:"Limit reached",instanceLimit:"",url:""},initialize:function(c,e){this.options=a.extend({},this.options,e);var b=this,d=a("ul.repeatable-list",c),h=a("li.hidden",d).remove(),g=a("li.repeatable-element",d).length;b.element=c;b.list=d;b.options.msgAddInstance=a("p.add a",c).html();a("li.repeatable-element",d).each(function(){a(this).children().wrapAll(a("<div>").addClass("repeatable-content")); b.attachButtons(a(this))});d.on("mousedown",".zlux-x-sort",function(){a(".more-options.show-advanced",d).removeClass("show-advanced");d.height(d.height());a(this).closest("li.repeatable-element").find(".more-options").hide().end().find(".file-details").hide()}).on("mouseup",".zlux-x-sort",function(){a(this).closest("li.repeatable-element").find(".more-options").show().end().find(".file-details").show()}).on("click",".zlux-x-delete",function(){a(this).closest("li.repeatable-element").fadeOut(200,function(){a(this).remove(); c.trigger("instance.deleted");b.options.instanceLimit&&a("p.add a",c).removeClass("disabled").html(b.options.msgAddInstance)})}).sortable({handle:".zlux-x-sort",placeholder:"repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:!1,start:function(c,b){b.item.addClass("ghost");b.placeholder.height(b.item.height()-2);b.placeholder.width(a("div.repeatable-content",b.item).width()-2)},stop:function(c,b){b.item.removeClass("ghost");a(".more-options", b.item).show();a(".file-details",b.item).show();d.height("");a(".repeatable-element",a(c.target)).each(function(b){a("input, textarea",a(this)).each(function(){if(a(this).attr("name")){var c=a(this).attr("name").replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+b+"]");a(this).attr("name",c)}})})}});a("p.add a",c).on("click",function(){if(b.options.instanceLimit&&b.options.instanceLimit<=d.children().length)return!1;b.addElementInstance(h.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+g++ +"]"));b.options.instanceLimit&& b.options.instanceLimit<=d.children().length&&a("p.add a",c).addClass("disabled").html(b.options.msgLimitReached)});a(".btn-group.ajax-add-instance .dropdown-menu a",c).on("click",function(){var d=a(this),e=d.closest(".btn-group").find(".btn.dropdown-toggle").addClass("btn-working"),d=d.data("layout");a.ajax({url:b.options.ajax_url+"&task=callelement",type:"POST",data:{method:"loadeditlayout",layout:d},success:function(a){b.addElementInstance(a.replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+g++ +"]")); e.removeClass("btn-working");c.trigger("instance.added")}})})},addElementInstance:function(c){c=a('<li class="repeatable-element" />').html(c);c.children().wrapAll(a("<div>").addClass("repeatable-content"));this.attachButtons(c);a("input, textarea",c).filter(function(){return"hidden"!=a(this).attr("type")}).each(function(){a(this).val("").html("")});c.appendTo(this.list);c.children("div.repeatable-content").effect("highlight",{},1E3)},attachButtons:function(c){a(".zlux-x-sort, .zlux-x-delete",c)[0]|| (a("<span>").addClass("zlux-x-sort sort").attr("title",this.options.msgSortElement).appendTo(c),a("<span>").addClass("zlux-x-delete delete").attr("title",this.options.msgDeleteElement).appendTo(c))}});a.fn[e.prototype.name]=function(){var c=arguments,f=c[0]?c[0]:null;return this.each(function(){var b=a(this);if(e.prototype[f]&&b.data(e.prototype.name)&&"initialize"!=f)b.data(e.prototype.name)[f].apply(b.data(e.prototype.name),Array.prototype.slice.call(c,1));else if(!f||a.isPlainObject(f)){var d= new e;e.prototype.initialize&&d.initialize.apply(d,a.merge([b],c));b.data(e.prototype.name,d)}else a.error("Method "+f+" does not exist on jQuery."+e.name)})}})(jQuery);