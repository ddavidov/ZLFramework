/* ===================================================
 * Files Pro edit script
 * https://zoolanders.com/extensions/zl-framework
 * ===================================================
 * Copyright (C) JOOlanders SL 
 * http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 only
 * ========================================================== */
(function(a){var b=function(c){this.options=a.extend({},this.options,c);this.events={}};b.prototype=a.extend(b.prototype,a.fn.zluxMain.prototype,{name:"ElementFilespro",options:{root:"",extensions:"",storage:"",fileMode:"",max_file_size:"",title:""},events:{},initialize:function(c,d){this.options=a.extend({},a.fn.zluxMain.prototype.options,this.options,d);var b=this;b.element=c;c.on("click","p.add a",function(){b.apply(a("input.filespro",c))});b.apply(a("input.filespro",c))},apply:function(b){var d= this;b.each(function(b,c){var f=a(c);if(!a(c).data("initialized")){var e="filespro-element-"+b,g=f.closest(".row").addClass("zl-bootstrap"),k=f.hasClass("image-element")?!0:!1;f.attr("id",e);d.zluxpreview=a.fn.zluxPreview();e=a("span.zlux-x-filedata",g).data("zlux-storage");f.zluxDialogFilesManager({root:d.options.images,extensions:d.options.extensions,storage:"local",max_file_size:"1024kb",title:d.options.title,storage:e.engine,storage_params:e,root:e.root}).data("zluxDialogFilesManager").bind("ObjectSelected", function(b,c){if(!("files"==d.options.fileMode&&"file"!=c.type)&&!("folders"==d.options.fileMode&&"folder"!=c.type)){var e=f.data("zluxDialogFilesManager")._getFullPath(c.name);f.val(e).trigger("change");a(".zlux-preview",g).remove();g.append(d.zluxpreview.renderPreviewDOM(c,k))}});e=a("span.zlux-x-filedata",g).data("zlux-data");a.isEmptyObject(e)||g.append(d.zluxpreview.renderPreviewDOM(e,k));a('<i class="icon-remove zlux-x-cancel-btn" />').insertAfter(f).on("click",function(){f.val("");a(".zlux-preview", g).remove()})}f.data("initialized",!0)})}});a.fn[b.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var h=a(this);if(b.prototype[d]&&h.data(b.prototype.name)&&"initialize"!=d)h.data(b.prototype.name)[d].apply(h.data(b.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var j=new b;b.prototype.initialize&&j.initialize.apply(j,a.merge([h],c));h.data(b.prototype.name,j)}else a.error("Method "+d+" does not exist on jQuery."+b.name)})}})(jQuery);