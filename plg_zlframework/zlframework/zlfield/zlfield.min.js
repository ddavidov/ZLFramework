(function(c){var k=function(){};k.prototype=c.extend(k.prototype,{name:"ZLfield",options:{url:"",type:"",enviroment:"",enviroment_args:""},initialize:function(b,h){this.options=c.extend({},this.options,h);var a=this;c("#toolbar-apply, #toolbar-save").click(function(){c(".zlfield input").each(function(){c(this).val()||c(this).remove()});return!0});c(document).ready(function(){c(".zlfield-main .chzn-container").each(function(){c(this).prev("select").data("chosen",null).show();c(this).remove()});c(".col-left ul.element-list").on("element.added",
function(f,p){a.actions(c(p))});c("ul.ui-sortable").on("sortstop",function(f,p){var b=RegExp(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/);c("#assign-elements ul.element-list:not(.unassigned)").each(function(){var a="positions["+c(this).data("position")+"]";c(this).children().each(function(j){c(this).find("[data-control^=positions], [data-control^=elements]").each(function(){c(this).attr("data-control","tmp"+c(this).attr("data-control").replace(b,a+"["+j+"]"))})})});b=RegExp(/^tmp/);
c("#assign-elements ul.element-list").find("[data-control^=tmp]").each(function(){c(this).attr("data-control",c(this).attr("data-control").replace(b,""))});a.actions(p.item)});a.initActions()})},initActions:function(){var b=this,h=b.options.enviroment;("type-positions"==h||"type-edit"==h)&&c(".col-left ul.ui-sortable > li.element").each(function(){c(this).parent().trigger("sortstop",{item:c(this)})});"type-edit"==h&&c(".col-left .core-element-configuration .element-list > li.element").each(function(){b.actions(c(this))});
"item-edit"==h&&c(".item-edit .creation-form .zlfield-main").each(function(){b.actions(c(this))});"module"==h&&c("form#module-form .zlfield-main").each(function(){c(this).closest("li, .control-group").addClass("zlfield-module");c(this).closest(".controls").removeClass("controls");b.actions(c(this))});"app-config"==h&&c(".col-right .zlfield-main").each(function(){b.actions(c(this))})},actions:function(b){var h=this;b.data("zlfield-actions-init")||(b.find(".qTipHelp").each(function(){var a=c(this);
a.qtip({overwrite:!1,content:{text:a.find(".qtip-content")},position:{my:"bottom center",at:"top center",viewport:c(window)},show:{solo:!0,delay:300},hide:{fixed:!0,delay:300},style:"ui-tooltip-light ui-tooltip-zlparam"})}),b.find(".zl-select-expand").each(function(){var a=c(this);a.click(function(){c(this).prev().height(150);c(this).remove()}).qtip({overwrite:!1,content:{text:a.data("zl-qtip")},position:{at:"right top",my:"left bottom"},show:{solo:!0,delay:600},hide:{delay:0},style:"ui-tooltip-light ui-tooltip-zlparam"})}),
c("#toolbar-apply, #toolbar-save").on("mousedown",function(){b.find(".row[data-type=password] .zl-field input").each(function(){c(this).val("zl-decrypted["+c(this).val()+"]")})}),b.find(".zl-state").each(function(){var a=c(this).find("input"),f=a.closest(".row");a.bind("change",function(){"checked"==c(this).attr("checked")?(f.removeClass("zl-disabled"),f.find(".zl-field").children().removeAttr("disabled")):(f.addClass("zl-disabled"),f.find(".zl-field").children().attr("disabled",!0))})}),b.find(".zl-state input").each(function(){var a=
c(this);a.qtip({content:{text:"Override this field"},position:{at:"left top",my:"right bottom",effect:!1},show:{target:a.closest(".row"),solo:!0,delay:200},hide:{target:a.closest(".row"),delay:0},style:"ui-tooltip-light ui-tooltip-zlparam",events:{show:function(c,b){"checked"==a.attr("checked")&&c.preventDefault();a.bind("change",function(){b.hide()});b.set("content.text",a.parent().attr("tooltip"))}}})}),b.find(".zl-toggle").each(function(){var a=c(this),b=a.next();c(".btn-open",a).on("click",function(){a.toggleClass("open")&&
b.show()});c(".btn-close",a).on("click",function(){a.toggleClass("open")&&b.hide()})}),b.find("[data-dependents]").each(function(){var a=c(this),b=a.data("dependents").replace(/ /g,"").split("|"),h=a.closest(".zlfield.placeholder .wrapper, .zlfield.placeholder").first();b.each(function(b){var f=b.split("!>"),j=2==f.length?"!>":">",f=">"==j?b.split(">"):f;d=f[0].split(",");e=f[1].replace("NONE","");("select"==a.data("type")||"itemLayoutList"==a.data("type")||"layout"==a.data("type")||"apps"==a.data("type")||
"types"==a.data("type")||"elements"==a.data("type")||"modulelist"==a.data("type")||"separatedby"==a.data("type"))&&d.each(function(b){var g=h.find('[data-id="'+b+'"]').data("e",e).data("m",j).hide();a.find(".zl-field select").bind("change",function(){var a=g.data("e"),b=g.data("m"),j=c.makeArray(c(this).val()),f=0;if(a&&a.match(/OR/g))c.each(j,function(c,j){var g=RegExp("(\\b|OR)"+j+"(\\b|OR)","g");("!>"==b&&!a.match(g)||">"==b&&a.match(g))&&(f=1)});else if(a&&a.match(/AND/g)){var h=a.split("AND").length;
j.length==h&&c.each(j,function(c,j){var g=RegExp("(\\b|AND)"+j+"(\\b|AND)","g");f="!>"==b&&!a.match(g)||">"==b&&a.match(g)?1:0})}else c.each(j,function(c,j){("!>"==b&&j!=a||">"==b&&j==a)&&(f=1)});f&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")});"checkbox"==a.data("type")&&d.each(function(b){var g=h.find('[data-id="'+b+'"]').hide();a.find(".zl-field input").bind("change",function(){var a="checked"==c(this).attr("checked");("!>"==j&&!a||">"==j&&a)&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")});
"radio"==a.data("type")&&d.each(function(b){var g=e,f=h.find('[data-id="'+b+'"]').hide();a.find(".zl-field input").bind("change",function(){var a="checked"==c(this).attr("checked"),b=0,h=c(this).attr("value");a&&(g&&g.match(/OR/g)?(a=RegExp(h,"g"),("!>"==j&&!g.match(a)||">"==j&&g.match(a))&&(b=1)):("!>"==j&&h!=g&&a||">"==j&&(h==g&&a)&&a)&&(b=1),b&&f.slideDown("fast")||f.slideUp("fast"))}).trigger("change")});"text"==a.data("type")&&d.each(function(b){var g=h.find('[data-id="'+b+'"]').hide();a.find(".zl-field input").on("keyup change",
function(){var a=""!=c(this).val();("!>"==j&&!a||">"==j&&a)&&g.slideDown("fast")||g.slideUp("fast")}).trigger("change")})})}),b.find("[data-dependent]").each(function(){var a=c(this).hide(),b=a.data("dependent").replace(/ /g,"").split("&&"),h=a.closest(".zlfield.placeholder .wrapper, .zlfield.placeholder").first();a.bind("zlfield-dependent-event",function(){var m=0,k=1;b.each(function(b){if(!k)return!1;var f=b.split("!="),g=2==f.length?"!=":"==",f="=="==g?b.split("=="):f;field=h.find('[data-id="'+
f[0]+'"]');type=field.data("type");unique_id=field.data("id")+"_"+h.data("id");e=f[1].replace("NONE","");if("select"==type||"itemLayoutList"==type||"layout"==type||"apps"==type||"types"==type||"elements"==type||"modulelist"==type||"separatedby"==type){b=field.find(".zl-field select");var f=c.makeArray(b.val()),l=0;if(e&&e.match(/OR/g))c.each(f,function(a,c){var b=RegExp("(\\b|OR)"+c+"(\\b|OR)","g");("!="==g&&!e.match(b)||"=="==g&&e.match(b))&&(l=1)});else if(e&&e.match(/AND/g)){var q=e.split("AND").length;
f.length==q&&c.each(f,function(a,c){var b=RegExp("(\\b|AND)"+c+"(\\b|AND)","g");l="!="==g&&!e.match(b)||"=="==g&&e.match(b)?1:0})}else c.each(f,function(a,c){("!="==g&&c!=e||"=="==g&&c==e)&&(l=1)});m=l;b.data("zlfield-dependent-"+unique_id+"-init")||(b.on("change",function(){a.trigger("zlfield-dependent-event")}),b.data("zlfield-dependent-"+unique_id+"-init",!0))}"checkbox"==type&&(b=field.find(".zl-field input"),l=0,f="checked"==b.attr("checked"),("!="==g&&!f||"=="==g&&f)&&(l=1),m=l,b.data("zlfield-dependent-"+
unique_id+"-init")||(b.on("change",function(){a.trigger("zlfield-dependent-event")}),b.data("zlfield-dependent-"+unique_id+"-init",!0)));if("radio"==type){b=field.find(".zl-field input");var l=0,n=e;b.each(function(){var a="checked"==c(this).attr("checked"),b=c(this).attr("value");a&&(n&&n.match(/OR/g)?(a=RegExp(b,"g"),("!="==g&&!n.match(a)||"=="==g&&n.match(a))&&(l=1)):("!="==g&&b!=n&&a||"=="==g&&(b==n&&a)&&a)&&(l=1))});m=l;b.data("zlfield-dependent-"+unique_id+"-init")||(b.on("change",function(){a.trigger("zlfield-dependent-event")}),
b.data("zlfield-dependent-"+unique_id+"-init",!0))}"text"==type&&(b=field.find(".zl-field input"),f=""!=b.val(),("!="==g&&!f||"=="==g&&f)&&(l=1),m=l,b.data("zlfield-dependent-"+unique_id+"-init")||(b.on("keyup change",function(){a.trigger("zlfield-dependent-event")}),b.data("zlfield-dependent-"+unique_id+"-init",!0)));m||(k=!1)});m&&a.slideDown("fast")||a.slideUp("fast")}).trigger("zlfield-dependent-event")}),b.find("[data-relieson]").each(function(){var a=c(this),b=a.data("relieson"),k=a.parents(".placeholder").find('[data-id="'+
b.id+'"]').find("select");k.on("change",function(){var m=c(this).val()?c(this).val():"",r=c(this).closest(".zl-field"),j=b.json,s=a.attr("data-control"),g=c(this).closest(".zlfield-main").attr("data-ajaxargs"),l=b.psv,q=b.id;l[b.id]=m;r.append(c('<span class="activity zl-loader">'));c.getJSON(b.url,{task:"loadfield",json:j,ctrl:s,psv:l,pid:q,node:null,args:g,ajaxcall:!0,enviroment:h.options.enviroment,enviroment_args:h.options.enviroment_args},function(b){r.find(".activity").remove();a.slideUp("fast",
function(){a.empty();b&&b.result&&a.html('<div class="loaded-fields">'+b.result+"</div>");h.actions(a.find("> .loaded-fields"));a.slideDown("fast");k.trigger("loaded.zlfield")})})})}),b.find(".load-field-btn").on("click",function(a){a.preventDefault();a=c(this);var b=a.parent(".zlfield-main"),k=b.data("ajaxargs");a.find("span").addClass("zlux-loader-raw");c.ajax({url:h.options.url,type:"POST",data:{task:"loadZLfield",group:k.group,type:h.options.type,control_name:k.control_name,json_path:k.json_path,
element_id:k.element_id,element_type:k.element_type,enviroment:k.enviroment,node:k.node},success:function(a){a=c.parseJSON(a);b.fadeOut("fast",function(){c(this).html(a.result);h.actions(b);b.fadeIn("slow")})}})}),b.data("zlfield-actions-init",!0))}});c.fn[k.prototype.name]=function(){var b=arguments,h=b[0]?b[0]:null;return this.each(function(){var a=c(this);if(k.prototype[h]&&a.data(k.prototype.name)&&"initialize"!=h)a.data(k.prototype.name)[h].apply(a.data(k.prototype.name),Array.prototype.slice.call(b,
1));else if(!h||c.isPlainObject(h)){var f=new k;k.prototype.initialize&&f.initialize.apply(f,c.merge([a],b));a.data(k.prototype.name,f)}else c.error("Method "+h+" does not exist on jQuery."+k.name)})}})(jQuery);