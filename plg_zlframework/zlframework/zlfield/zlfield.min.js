(function(b){var j=function(){};j.prototype=b.extend(j.prototype,{name:"ZLfield",options:{url:"",type:"",enviroment:"",enviroment_args:""},initialize:function(c,g){this.options=b.extend({},this.options,g);var a=this;b("#toolbar-apply, #toolbar-save").click(function(){b(".zlfield input").each(function(){b(this).val()||b(this).remove()});return!0});b(document).ready(function(){b(".zlfield-main .chzn-container").each(function(){b(this).prev("select").data("chosen",null).show();b(this).remove()});b(".col-left ul.element-list").on("element.added",
function(f,q){a.actions(b(q))});b("ul.ui-sortable").on("sortstop",function(f,q){var g=RegExp(/(elements\[[a-z0-9_-]+\])|(positions\[[a-z0-9_-]+\]\[[0-9]+\])/);b("#assign-elements ul.element-list:not(.unassigned)").each(function(){var a="positions["+b(this).data("position")+"]";b(this).children().each(function(f){b(this).find("[data-control^=positions], [data-control^=elements]").each(function(){b(this).attr("data-control","tmp"+b(this).attr("data-control").replace(g,a+"["+f+"]"))})})});g=RegExp(/^tmp/);
b("#assign-elements ul.element-list").find("[data-control^=tmp]").each(function(){b(this).attr("data-control",b(this).attr("data-control").replace(g,""))});a.actions(q.item)});a.initActions()})},initActions:function(){var c=this,g=c.options.enviroment;("type-positions"==g||"type-edit"==g)&&b(".col-left ul.ui-sortable > li.element").each(function(){b(this).parent().trigger("sortstop",{item:b(this)})});"type-edit"==g&&b(".col-left .core-element-configuration .element-list > li.element").each(function(){c.actions(b(this))});
"item-edit"==g&&b(".item-edit .creation-form .zlfield-main").each(function(){c.actions(b(this))});"module"==g&&b("form#module-form .zlfield-main").each(function(){b(this).closest("li, .control-group").addClass("zlfield-module");b(this).closest(".controls").removeClass("controls");c.actions(b(this))});"app-config"==g&&b(".col-right .zlfield-main").each(function(){c.actions(b(this))})},actions:function(c){var g=this;c.data("zlfield-actions-init")||(c.find(".qTipHelp").each(function(){var a=b(this);
a.qtip({overwrite:!1,content:{text:a.find(".qtip-content")},position:{my:"bottom center",at:"top center",viewport:b(window)},show:{solo:!0,delay:300},hide:{fixed:!0,delay:300},style:"ui-tooltip-light ui-tooltip-zlparam"})}),c.find(".zl-select-expand").each(function(){var a=b(this);a.click(function(){b(this).prev().height(150);b(this).remove()}).qtip({overwrite:!1,content:{text:a.data("zl-qtip")},position:{at:"right top",my:"left bottom"},show:{solo:!0,delay:600},hide:{delay:0},style:"ui-tooltip-light ui-tooltip-zlparam"})}),
b("#toolbar-apply, #toolbar-save").on("mousedown",function(){c.find(".zl-row[data-type=password] .zl-field input").each(function(){b(this).val("zl-decrypted["+b(this).val()+"]")})}),c.find(".zl-state").each(function(){var a=b(this).find("input"),f=a.closest(".zl-row");a.on("change",function(){"checked"==b(this).attr("checked")?(f.removeClass("zl-disabled"),f.find(".zl-field").children().removeAttr("disabled")):(f.addClass("zl-disabled"),f.find(".zl-field").children().attr("disabled",!0))}).trigger("change")}),
c.find(".zl-state input").each(function(){var a=b(this);a.qtip({content:{text:"Override this field"},position:{at:"left top",my:"right bottom",effect:!1},show:{target:a.closest(".zl-row"),solo:!0,delay:200},hide:{target:a.closest(".zl-row"),delay:0},style:"ui-tooltip-light ui-tooltip-zlparam",events:{show:function(b,g){"checked"==a.attr("checked")&&b.preventDefault();a.bind("change",function(){g.hide()});g.set("content.text",a.parent().attr("tooltip"))}}})}),c.find(".zl-toggle").each(function(){var a=
b(this),f=a.next();b(".btn-open",a).on("click",function(){a.toggleClass("open")&&f.show()});b(".btn-close",a).on("click",function(){a.toggleClass("open")&&f.hide()})}),c.find("[data-dependents]").each(function(){var a=b(this),f=a.data("dependents").replace(/ /g,"").split("|"),g=a.closest(".zlfield.placeholder .wrapper, .zlfield.placeholder").first();f.each(function(f){var h=f.split("!>"),k=2==h.length?"!>":">",h=">"==k?f.split(">"):h;d=h[0].split(",");e=h[1].replace("NONE","");("select"==a.data("type")||
"itemLayoutList"==a.data("type")||"layout"==a.data("type")||"apps"==a.data("type")||"types"==a.data("type")||"elements"==a.data("type")||"modulelist"==a.data("type")||"separatedby"==a.data("type"))&&d.each(function(f){var h=g.find('[data-id="'+f+'"]').data("e",e).data("m",k).hide();a.find(".zl-field select").bind("change",function(){var a=h.data("e"),f=h.data("m"),g=b.makeArray(b(this).val()),k=0;if(a&&a.match(/OR/g))b.each(g,function(b,g){var h=RegExp("(\\b|OR)"+g+"(\\b|OR)","g");("!>"==f&&!a.match(h)||
">"==f&&a.match(h))&&(k=1)});else if(a&&a.match(/AND/g)){var c=a.split("AND").length;g.length==c&&b.each(g,function(b,g){var h=RegExp("(\\b|AND)"+g+"(\\b|AND)","g");k="!>"==f&&!a.match(h)||">"==f&&a.match(h)?1:0})}else b.each(g,function(b,g){("!>"==f&&g!=a||">"==f&&g==a)&&(k=1)});k&&h.slideDown("fast")||h.slideUp("fast")}).trigger("change")});"checkbox"==a.data("type")&&d.each(function(f){var h=g.find('[data-id="'+f+'"]').hide();a.find(".zl-field input").bind("change",function(){var a="checked"==
b(this).attr("checked");("!>"==k&&!a||">"==k&&a)&&h.slideDown("fast")||h.slideUp("fast")}).trigger("change")});"radio"==a.data("type")&&d.each(function(f){var h=e,c=g.find('[data-id="'+f+'"]').hide();a.find(".zl-field input").bind("change",function(){var a="checked"==b(this).attr("checked"),g=0,f=b(this).attr("value");a&&(h&&h.match(/OR/g)?(a=RegExp(f,"g"),("!>"==k&&!h.match(a)||">"==k&&h.match(a))&&(g=1)):("!>"==k&&f!=h&&a||">"==k&&(f==h&&a)&&a)&&(g=1),g&&c.slideDown("fast")||c.slideUp("fast"))}).trigger("change")});
"text"==a.data("type")&&d.each(function(f){var h=g.find('[data-id="'+f+'"]').hide();a.find(".zl-field input").on("keyup change",function(){var a=""!=b(this).val();("!>"==k&&!a||">"==k&&a)&&h.slideDown("fast")||h.slideUp("fast")}).trigger("change")})})}),c.find("[data-dependent]").each(function(){var a=b(this).hide(),f=a.data("dependent").replace(/ /g,""),c=f.match(/AND/g)?f.split("AND"):[],j=f.match(/OR/g)?f.split("OR"):[],h=a.parents(".zlfield.placeholder .wrapper, .zlfield.placeholder").first();
a.on("zlfield-dependent-event",function(){A_match=0;(A_match=c.length?g.evaluateDependentRules(c,a,h,"AND"):g.evaluateDependentRules(j,a,h,"OR"))&&a.slideDown("fast")||a.slideUp("fast")}).trigger("zlfield-dependent-event")}),c.find("[data-relieson]").each(function(){var a=b(this),f=a.data("relieson"),c=a.parents(".placeholder").find('[data-id="'+f.id+'"]').find("select");c.on("change",function(){var j=b(this).val()?b(this).val():"",h=b(this).closest(".zl-field"),k=f.json,l=a.attr("data-control"),
m=b(this).closest(".zlfield-main").attr("data-ajaxargs"),p=f.psv,n=f.id;p[f.id]=j;h.append(b('<span class="activity zl-loader">'));b.getJSON(f.url,{task:"loadfield",json:k,ctrl:l,psv:p,pid:n,node:null,args:m,ajaxcall:!0,enviroment:g.options.enviroment,enviroment_args:g.options.enviroment_args},function(b){h.find(".activity").remove();a.slideUp("fast",function(){a.empty();b&&b.result&&a.html('<div class="loaded-fields">'+b.result+"</div>");g.actions(a.find("> .loaded-fields"));a.slideDown("fast");
c.trigger("loaded.zlfield")})})})}),c.find(".load-field-btn").on("click",function(a){a.preventDefault();a=b(this);var f=a.parent(".zlfield-main"),c=f.data("ajaxargs");a.find("span").addClass("zlux-loader-raw");b.ajax({url:g.options.url,type:"POST",data:{task:"loadZLfield",group:c.group,type:g.options.type,control_name:c.control_name,json_path:c.json_path,element_id:c.element_id,element_type:c.element_type,enviroment:c.enviroment,node:c.node},success:function(a){a=b.parseJSON(a);f.fadeOut("fast",function(){b(this).html(a.result);
g.actions(f);f.fadeIn("slow")})}})}),c.data("zlfield-actions-init",!0))},evaluateDependentRules:function(c,g,a,f){var j=0,r=1;c.each(function(h){if(!r)return!1;var c=h.split("!="),l=2==c.length?"!=":"==",c="=="==l?h.split("=="):c;field=a.find('[data-id="'+c[0]+'"]');type=field.data("type");unique_id=f+"-"+g.data("id")+"-"+field.data("id")+"-"+a.data("id");e=c[1].replace("NONE","");if("select"==type||"itemLayoutList"==type||"layout"==type||"apps"==type||"types"==type||"elements"==type||"modulelist"==
type||"separatedby"==type){h=field.find(".zl-field select");var c=b.makeArray(h.val()),m=0;if(e&&e.match(/OR/g))b.each(c,function(a,b){var c=RegExp("(\\b|OR)"+b+"(\\b|OR)","g");("!="==l&&!e.match(c)||"=="==l&&e.match(c))&&(m=1)});else if(e&&e.match(/AND/g)){var p=e.split("AND").length;c.length==p&&b.each(c,function(a,b){var c=RegExp("(\\b|AND)"+b+"(\\b|AND)","g");m="!="==l&&!e.match(c)||"=="==l&&e.match(c)?1:0})}else b.each(c,function(a,b){("!="==l&&b!=e||"=="==l&&b==e)&&(m=1)});j=m;h.data("zlfield-dependent-"+
unique_id+"-init")||(h.on("change",function(){g.trigger("zlfield-dependent-event")}),h.data("zlfield-dependent-"+unique_id+"-init",!0))}"checkbox"==type&&(h=field.find(".zl-field input"),m=0,c="checked"==h.attr("checked"),("!="==l&&!c||"=="==l&&c)&&(m=1),j=m,h.data("zlfield-dependent-"+unique_id+"-init")||(h.on("change",function(){g.trigger("zlfield-dependent-event")}),h.data("zlfield-dependent-"+unique_id+"-init",!0)));if("radio"==type){h=field.find(".zl-field input");var m=0,n=e;h.each(function(){var a=
"checked"==b(this).attr("checked"),c=b(this).attr("value");a&&(n&&n.match(/OR/g)?(a=RegExp(c,"g"),("!="==l&&!n.match(a)||"=="==l&&n.match(a))&&(m=1)):("!="==l&&c!=n&&a||"=="==l&&(c==n&&a)&&a)&&(m=1))});j=m;h.data("zlfield-dependent-"+unique_id+"-init")||(h.on("change",function(){g.trigger("zlfield-dependent-event")}),h.data("zlfield-dependent-"+unique_id+"-init",!0))}"text"==type&&(h=field.find(".zl-field input"),c=""!=h.val(),("!="==l&&!c||"=="==l&&c)&&(m=1),j=m,h.data("zlfield-dependent-"+unique_id+
"-init")||(h.on("keyup change",function(){g.trigger("zlfield-dependent-event")}),h.data("zlfield-dependent-"+unique_id+"-init",!0)));if("AND"==f&&!j||"OR"==f&&j)r=!1});return j}});b.fn[j.prototype.name]=function(){var c=arguments,g=c[0]?c[0]:null;return this.each(function(){var a=b(this);if(j.prototype[g]&&a.data(j.prototype.name)&&"initialize"!=g)a.data(j.prototype.name)[g].apply(a.data(j.prototype.name),Array.prototype.slice.call(c,1));else if(!g||b.isPlainObject(g)){var f=new j;j.prototype.initialize&&
f.initialize.apply(f,b.merge([a],c));a.data(j.prototype.name,f)}else b.error("Method "+g+" does not exist on jQuery."+j.name)})}})(jQuery);