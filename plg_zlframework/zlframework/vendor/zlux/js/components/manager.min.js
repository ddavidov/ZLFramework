/**
 * @package     zlux
 * @version     2.0.2
 * @author      ZOOlanders - http://zoolanders.com
 * @license     GNU General Public License v2 or later
 */

!function(e,t,s,n,i){"use strict";var a;t.extensions.manager={id:0,init:function(){},getResource:function(e){return e instanceof jQuery?e.data("managerResource"):e},preResourceDelete:function(){},deleteResource:function(s){var n=this,i={url:e.zx.url.ajax("zlux","deleteResource"),data:{type:n.type}};this.preResourceDelete(s,i),t.ajax.request(i).done(function(){s.element.fadeOut("slow",function(){e(this).remove(),n.trigger("resourceDeleted",s)})}).fail(function(){}).always(function(){})},initResources:function(s){var n=this;s=s===i?n.find(".zx-manager-resources"):s,t.datatables(),n.resources=s.dataTable(e.extend(!0,{},t.datatables.settings,n.DTsettings)).DataTable(),n.DT_wrapper=s.closest(".dataTables_wrapper").addClass("uk-hidden"),n.resources.on("init",function(){n.trigger("resourcesInit")}),n.resources.on("click",".zx-x-details-btn",function(){var t=e(this),s=t.closest(".zx-manager-resource"),n=e(".zx-x-details",s);s.hasClass("zx-open")?(t.addClass("uk-icon-angle-down").removeClass("uk-icon-angle-up"),s.removeClass("zx-open"),n.slideUp("fast",function(){})):(s.addClass("zx-open"),t.removeClass("uk-icon-angle-down").addClass("uk-icon-angle-up"),n.slideDown("fast",function(){}))}),n.resources.on("click",".zx-manager-resource .zx-x-name a",function(t){t.preventDefault(),n.trigger("resourceSelected",n.getResource(e(this).closest(".zx-manager-resource")))}),n.resources.on("click",".zx-manager-resource .zx-x-remove",function(s){s.preventDefault();var i=n.getResource(e(this).closest(".zx-manager-resource"));t.notify.confirm(t.lang._("DELETE_THIS_RESOURCE"),{timeout:!1}).done(function(){n.deleteResource(i)})})},DTsettings:{serverSide:!0}},t.component("managerResource",{data:{editable:!1},defaults:{template:'<div class="zx-x-tools">                                <i class="zx-x-details-btn uk-icon-angle-down" />                                {{#editable}}                                <i class="zx-x-remove uk-icon-minus-circle" data-uk-tooltip title="'+t.lang._("DELETE")+'" />                                {{/some}}                            </div>                            <div class="zx-x-name"><a href="#" class="zx-x-name-link">{{name}}</a></div>                            {{#details && details.length}}                            <div class="zx-x-details">                                <div class="zx-x-messages" />                                <div class="zx-x-details-content">                                    <ul class="uk-list">                                        {{~details}}                                        <li>{{$item}}</li>                                        {{/details}}                                        </ul>                                </div>                            </div>                            {{/end}}'},init:function(){},render:function(){return e.UIkit.Utils.template(this.options.template,this.data)},pushData:function(t){this.data=e.extend({},this.data,t)}}),t.component("managerNav",{defaults:{template:'<ul class="uk-navbar-nav">                                <li class="uk-parent" data-uk-dropdown>                                    <a href=""><i class="uk-icon-bars"></i></a>                                    <div class="uk-dropdown uk-dropdown-navbar">                                        <ul class="uk-nav uk-nav-navbar">                                            <li><a href="">Another item</a></li>                                        </ul>                                    </div>                                </li>                            </ul>                            <div class="uk-navbar-content">                                <form class="uk-form uk-margin-remove uk-display-inline-block">                                   <input type="text" placeholder="Search">                                </form>                            </div>',option_tmpl:'<li><a href=""><i class="uk-icon-{{icon}}"></i> Some text </a></li>'},init:function(){this.element.append(this.options.template)},addChild:function(t){this.find(".uk-dropdown > ul").append(e.UIkit.Utils.template(this.options.option_tmpl,t))}}),t.extensions.managerDropdown=e.extend(!0,{},t.extensions.manager,{defaults:{init_display:"",offsettop:5,template:function(){var e="";return e+='<div class="zx-manager-nav">',e+='<div class="uk-search">',e+='<input class="uk-search-field" type="search" placeholder="search...">',e+='<button class="uk-search-close" type="reset"></button>',e+="</div>",e+="</div>",e+='<div class="zx-manager-spinner uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin"></i></div>',e+='<table class="uk-table zx-manager-resources"></table>'}},init:function(){var t=this;this.current=this.element.val(),this.hidden=this.element.clone().attr("type","hidden").removeAttr("data-zx-itempicker").insertAfter(this.element),this.element.val(this.options.init_display).removeAttr("name"),this.on("focus",function(){e(".uk-search-field",this.dropdown).focus()}),this.on("resourcesInit",function(){t.DT_wrapper.closest(".dataTables_wrapper").removeClass("uk-hidden"),e(".zx-manager-spinner",this.dropdown).remove()})},initDropdown:function(t){var s=this;if(!t){t=e('<div class="uk-dropdown zx-manager zx"></div>');var n=null;t.on("keyup",".uk-search-field",function(i){var a=e(this).val();""===a?e(".uk-search-close",t).hide():e(".uk-search-close",t).show(),clearTimeout(n),""===a&&s.resources.search("").draw();var o=i.keyCode?i.keyCode:i.which;return 13==o?void s.resources.search(a).draw():void(n=setTimeout(function(){s.resources.search(a).draw()},500))}),t.on("click",".uk-search-close",function(){e(".uk-search-field",t).val(""),e(this).hide(),s.resources.search("").draw()}),t.appendTo("body")}return this.dropdown=t,t},pick:function(t){var n=this.element.offset(),i={top:n.top+this.element.outerHeight()+this.options.offsettop,left:n.left,right:""};this.current=t?t:null,this.inititem=this.current,this.update(),"right"==e.UIkit.langdirection&&(i.right=s.innerWidth-(i.left+this.element.outerWidth()),i.left=""),this.dropdown.css(i).show(),e(".uk-search-field",a).focus()},update:function(){var t=this,s={},n=this.options.template(s,this.options);this.dropdown.html(n),t.on("resourceSelected",function(e,s){t.element.val(s.data.name),t.hidden.val(s.data.id)}),this.initResources(e(".zx-manager-resources",this.dropdown))}})}(jQuery,jQuery.zx,window,document);